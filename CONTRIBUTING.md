< [README](./README.md)

# Contributing to Fresnel

Refer to [API.md](./API.md) for overview of how Fresnel works
internally, as well as function-level documentation.

To contribute, you'll want to install Fresnel directly from the
Git repository, and create a dynamic link for easy use from the
command-line:

```
$ git clone https://gerrit.wikimedia.org/r/performance/fresnel
$ cd fresnel/

fresnel$ npm install
fresnel$ npm link

# Then, use the 'fresnel' command.
```

## Build steps

* `npm run test`
  Runs the linter, tests and regenerate the API docs.
  To run a specific test suite only, use `npx qunit path/to/test.js`
* `npm run doc`
  Regenerates the API docs.
* `npm run doc:dump`
 Â Lists the available [JSDoc identifiers](https://github.com/jsdoc2md/jsdoc-to-markdown/wiki/Listing-namepaths) to help with `{@link}` inside comments.

This project is primarily installed as a command-line tool, not as a library.
As such, it maintains an `npm-shrinkwrap.json` file instead of a `package-lock.json` file.
See also <https://docs.npmjs.com/files/package-locks> and <https://docs.npmjs.com/cli/shrinkwrap>.

## Documentation

This project is documented with [JSDoc](http://usejsdoc.org/). [API.md](./API.md) is generated by [jsdoc2md](https://github.com/jsdoc2md/jsdoc-to-markdown/wiki). To locally view the Markdown files in a browser, you could [npm install -g md-fileserver](https://www.npmjs.com/package/md-fileserver) and  run `mdopen API.md`.

## Tests

This project is tested with [QUnit](https://api.qunitjs.com/assert/), using [nyc](https://istanbul.js.org/) for code coverage. The coverage report gets generated as part of the `npm run test` command. The nyc tool is configured in `package.json`. Run `npx nyc help config` to view its option documentation.

View the latest code coverage report at <https://doc.wikimedia.org/cover/fresnel/>. Or, open `coverage/index.html` locally in a browser after running the tests.

## Release

To prepare the release commit, follow these steps:

1. Set the next version in `package.json`.
2. Run `npm install` to ensure the `npm-shrinkwrap.json` file reflects the version change.
   If it contains other changes as well, this means a previous commit forgot to update
   the shrinkwrap when changing dependencies. In that case, commit and review those changes
   first on their own, before preceeding with the release.
3. Add a section to `CHANGELOG.md` for this release. If you have [git-extras](https://github.com/tj/git-extras)
   installed, use `npm run changelog` to automatically create a section with today's date and the commits
   since the previous release.

   Only mention changes that affect the public API, CLI, or program output.
   and use Added/Changed/Deprecated/Removed/Fixed headings accordingly (see [keepachangelog.com](https://keepachangelog.com/en/1.0.0/)).
